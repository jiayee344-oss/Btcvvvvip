<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC/USDT å…¨è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .ob-buy-signal { 
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(21, 128, 61, 0.1));
            border: 2px solid #22c55e;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }
        .ob-sell-signal { 
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(185, 28, 28, 0.1));
            border: 2px solid #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }
        
        .sr-level {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        .sr-support { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .sr-resistance { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        .tp-sl-reason {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 6px;
            padding: 8px;
            margin-top: 4px;
            font-size: 11px;
            border-left: 2px solid;
        }
        .reason-tp { border-left-color: #10b981; }
        .reason-sl { border-left-color: #ef4444; }
        
        .reason-badge {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 4px;
        }
        .badge-sr { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .badge-ob { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .badge-choch { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        
        .price-distance {
            font-size: 11px;
            padding: 1px 4px;
            border-radius: 3px;
            margin-left: 4px;
        }
        .distance-near { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .distance-medium { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }
        .distance-far { background: rgba(75, 85, 99, 0.2); color: #4b5563; }
        
        .risk-level {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        .risk-low { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .risk-medium { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
        .risk-high { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        
        .telegram-status {
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            margin-left: 10px;
        }
        .telegram-connected { background: rgba(34, 197, 94, 0.2); color: #22c55e; border: 1px solid #22c55e; }
        .telegram-disconnected { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid #ef4444; }
        .telegram-sending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; border: 1px solid #f59e0b; }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .auto-mode {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(168, 85, 247, 0.1));
            border: 2px solid #8b5cf6;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        
        .signal-history-item {
            padding: 8px 12px;
            margin-bottom: 6px;
            border-radius: 6px;
            background: rgba(30, 41, 59, 0.5);
            border-left: 4px solid;
        }
        .signal-buy { border-left-color: #22c55e; }
        .signal-sell { border-left-color: #ef4444; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="container mx-auto p-4 max-w-7xl">
        <!-- å¤´éƒ¨ -->
        <div class="text-center mb-8 pt-4">
            <h1 class="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500 mb-3">
                <i class="fas fa-robot mr-3"></i>BTC/USDT å…¨è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ
            </h1>
            <p class="text-gray-400 text-lg">å®æ—¶åˆ†æ + æ™ºèƒ½TP/SL + å…¨è‡ªåŠ¨Telegramæ¨é€</p>
            <div class="flex justify-center items-center mt-4">
                <div id="priceDisplay" class="text-xl font-bold mr-4">
                    <span id="currentPrice">åŠ è½½ä¸­...</span>
                    <span id="priceChange" class="text-sm ml-2"></span>
                </div>
                <div id="systemMode" class="px-4 py-2 bg-purple-600 rounded-lg font-semibold">
                    <i class="fas fa-cog fa-spin mr-2"></i>å…¨è‡ªåŠ¨æ¨¡å¼
                </div>
            </div>
        </div>

        <!-- è‡ªåŠ¨åŒ–æ§åˆ¶é¢æ¿ -->
        <div class="bg-gray-800 rounded-xl p-6 mb-6 shadow-lg border border-gray-700 auto-mode">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-bolt text-yellow-400 mr-2"></i>è‡ªåŠ¨åŒ–é…ç½®
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="p-4 bg-gray-900/70 rounded-lg">
                    <h3 class="text-lg font-semibold text-green-400 mb-2">
                        <i class="fas fa-sync-alt mr-2"></i>åˆ†æé¢‘ç‡
                    </h3>
                    <div class="text-sm text-gray-300">
                        <div class="mb-2">æ¯ <span id="analysisInterval">30</span> ç§’åˆ†æä¸€æ¬¡</div>
                        <input type="range" id="intervalSlider" min="10" max="60" value="30" step="10" class="w-full">
                    </div>
                </div>
                
                <div class="p-4 bg-gray-900/70 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-400 mb-2">
                        <i class="fas fa-bell mr-2"></i>ä¿¡å·æ¨é€
                    </h3>
                    <div class="space-y-2">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-green-500 mr-2"></div>
                            <span class="text-sm">è‡ªåŠ¨å‘é€æ‰€æœ‰ä¿¡å·</span>
                        </div>
                        <div class="text-xs text-gray-400">
                            å·²å‘é€: <span id="sentCount">0</span> ä¸ªä¿¡å·
                        </div>
                    </div>
                </div>
                
                <div class="p-4 bg-gray-900/70 rounded-lg">
                    <h3 class="text-lg font-semibold text-red-400 mb-2">
                        <i class="fas fa-filter mr-2"></i>ä¿¡å·è¿‡æ»¤
                    </h3>
                    <div class="space-y-2">
                        <div class="text-sm">
                            æœ€å°ç½®ä¿¡åº¦: <span id="minConfidence">70</span>%
                        </div>
                        <input type="range" id="confidenceSlider" min="50" max="90" value="70" step="5" class="w-full">
                    </div>
                </div>
                
                <div class="p-4 bg-gray-900/70 rounded-lg">
                    <h3 class="text-lg font-semibold text-cyan-400 mb-2">
                        <i class="fas fa-chart-line mr-2"></i>TP/SLç­–ç•¥
                    </h3>
                    <div class="text-sm text-gray-300">
                        <div>åŸºäºçœŸå®æ”¯æ’‘é˜»åŠ›</div>
                        <div class="text-xs text-gray-400 mt-1">æ™ºèƒ½åŠ¨æ€è°ƒæ•´</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å®æ—¶åˆ†æé¢æ¿ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- å½“å‰ä¿¡å· -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">
                        <i class="fas fa-bullhorn text-cyan-400 mr-2"></i>å½“å‰ä¿¡å·
                    </h2>
                    <div id="lastSignalTime" class="text-sm text-gray-500">--</div>
                </div>
                
                <div id="currentSignal" class="space-y-4">
                    <div class="text-center py-8">
                        <div class="loading mx-auto mb-4"></div>
                        <div class="text-gray-400">æ­£åœ¨åˆ†æå®æ—¶ä¿¡å·...</div>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»ŸçŠ¶æ€ -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <h2 class="text-xl font-semibold mb-6">
                    <i class="fas fa-chart-bar text-green-400 mr-2"></i>ç³»ç»ŸçŠ¶æ€
                </h2>
                
                <div class="space-y-4">
                    <div class="p-3 bg-gray-900/50 rounded">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">TelegramçŠ¶æ€</span>
                            <span id="telegramStatus" class="text-red-400">æœªè¿æ¥</span>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-gray-900/50 rounded">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">åˆ†ææ¬¡æ•°</span>
                            <span id="analysisCount" class="text-blue-400">0</span>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-gray-900/50 rounded">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">ä¿¡å·å‘½ä¸­ç‡</span>
                            <span id="hitRate" class="text-green-400">--%</span>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-gray-900/50 rounded">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">ç³»ç»Ÿè¿è¡Œ</span>
                            <span id="uptime" class="text-yellow-400">00:00:00</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¿¡å·å†å² -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-semibold">
                        <i class="fas fa-history text-purple-400 mr-2"></i>ä¿¡å·å†å²
                    </h2>
                    <button onclick="clearSignalHistory()" class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm">
                        <i class="fas fa-trash mr-1"></i>æ¸…ç©º
                    </button>
                </div>
                
                <div id="signalHistory" class="space-y-2 max-h-64 overflow-y-auto">
                    <div class="text-center text-gray-500 py-4">æš‚æ— å†å²ä¿¡å·</div>
                </div>
            </div>
        </div>

        <!-- è¯¦ç»†ä¿¡å·åˆ†æ -->
        <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700 mb-8">
            <h2 class="text-xl font-semibold mb-6">
                <i class="fas fa-chart-line text-cyan-400 mr-2"></i>è¯¦ç»†ä¿¡å·åˆ†æ
            </h2>
            
            <div id="detailedAnalysis" class="space-y-6">
                <!-- ä¿¡å·æ¦‚è§ˆ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="p-4 bg-gray-900/50 rounded-lg text-center">
                        <div class="text-sm text-gray-400 mb-2">ä¿¡å·ç±»å‹</div>
                        <div id="signalType" class="text-2xl font-bold">--</div>
                    </div>
                    <div class="p-4 bg-gray-900/50 rounded-lg text-center">
                        <div class="text-sm text-gray-400 mb-2">å…¥åœºä»·æ ¼</div>
                        <div id="entryPriceDetail" class="text-2xl font-bold">--</div>
                    </div>
                    <div class="p-4 bg-gray-900/50 rounded-lg text-center">
                        <div class="text-sm text-gray-400 mb-2">ç½®ä¿¡åº¦</div>
                        <div id="confidenceDetail" class="text-2xl font-bold text-yellow-400">--%</div>
                    </div>
                    <div class="p-4 bg-gray-900/50 rounded-lg text-center">
                        <div class="text-sm text-gray-400 mb-2">é£é™©ç­‰çº§</div>
                        <div id="riskLevelDetail" class="text-2xl font-bold">--</div>
                    </div>
                </div>
                
                <!-- TP/SLåˆ†æ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 bg-gray-900/50 rounded-lg">
                        <h3 class="text-lg font-semibold text-green-400 mb-3">
                            <i class="fas fa-target mr-2"></i>æ­¢ç›ˆåˆ†æ
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <div class="text-sm text-gray-400">æ­¢ç›ˆä»·æ ¼</div>
                                <div id="takeProfitDetail" class="text-xl font-bold text-green-400">--</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">é¢„æœŸæ”¶ç›Š</div>
                                <div id="rewardPercentDetail" class="text-lg">--</div>
                            </div>
                            <div id="tpReasonDetail" class="tp-sl-reason reason-tp">
                                <div class="text-xs text-gray-400">æ­¢ç›ˆé€»è¾‘:</div>
                                <div class="text-xs text-gray-300">--</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-900/50 rounded-lg">
                        <h3 class="text-lg font-semibold text-red-400 mb-3">
                            <i class="fas fa-shield-alt mr-2"></i>æ­¢æŸåˆ†æ
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <div class="text-sm text-gray-400">æ­¢æŸä»·æ ¼</div>
                                <div id="stopLossDetail" class="text-xl font-bold text-red-400">--</div>
                            </div>
                            <div>
                                <div class="text-sm text-gray-400">é£é™©æ§åˆ¶</div>
                                <div id="riskPercentDetail" class="text-lg">--</div>
                            </div>
                            <div id="slReasonDetail" class="tp-sl-reason reason-sl">
                                <div class="text-xs text-gray-400">æ­¢æŸé€»è¾‘:</div>
                                <div class="text-xs text-gray-300">--</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è§¦å‘æ¡ä»¶ -->
                <div class="p-4 bg-gray-900/50 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3">
                        <i class="fas fa-list-check mr-2"></i>è§¦å‘æ¡ä»¶
                    </h3>
                    <div id="triggersList" class="space-y-2">
                        <div class="text-gray-400">ç­‰å¾…ä¿¡å·åˆ†æ...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è°ƒè¯•ä¿¡æ¯ -->
        <div class="bg-gray-800 rounded-xl p-4 shadow-lg border border-gray-700">
            <div class="flex justify-between items-center">
                <div class="text-sm text-gray-400">
                    <i class="fas fa-code mr-1"></i> ç³»ç»Ÿç‰ˆæœ¬: <span id="systemVersion">v2.0</span>
                </div>
                <div class="text-sm text-gray-400">
                    æœ€åæ›´æ–°: <span id="lastUpdate">--</span>
                </div>
                <div class="text-sm text-gray-400">
                    å†…å­˜ä½¿ç”¨: <span id="memoryUsage">-- MB</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== å…¨è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ ====================
        class FullyAutoTradingSystem {
            constructor() {
                this.state = {
                    currentPrice: 0,
                    supportLevels: [],
                    resistanceLevels: [],
                    orderBlocks: [],
                    marketStructure: { '5m': 'neutral', '15m': 'neutral' },
                    activeSignal: null,
                    signalHistory: [],
                    isAnalyzing: true,
                    analysisCount: 0,
                    signalCount: 0,
                    sentCount: 0,
                    startTime: Date.now(),
                    lastSignalTime: null,
                    telegramConnected: false
                };
                
                this.config = {
                    analysisInterval: 30000, // 30ç§’
                    minConfidence: 70,
                    autoSend: true,
                    tpSlConfig: {
                        minRRRatio: 1.5,
                        maxRiskPercent: 2.0,
                        tpAtKeyLevels: true,
                        slAtKeyLevels: true
                    }
                };
                
                this.telegramBot = new AutoTelegramBot();
                this.init();
            }
            
            init() {
                console.log('ğŸ¤– å…¨è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿåˆå§‹åŒ–');
                this.initEventListeners();
                this.startAutomation();
                this.updateUptime();
            }
            
            initEventListeners() {
                // åˆ†æé¢‘ç‡æ»‘å—
                document.getElementById('intervalSlider').addEventListener('input', (e) => {
                    const interval = parseInt(e.target.value);
                    this.config.analysisInterval = interval * 1000;
                    document.getElementById('analysisInterval').textContent = interval;
                    this.restartAutomation();
                });
                
                // ç½®ä¿¡åº¦æ»‘å—
                document.getElementById('confidenceSlider').addEventListener('input', (e) => {
                    const confidence = parseInt(e.target.value);
                    this.config.minConfidence = confidence;
                    document.getElementById('minConfidence').textContent = confidence;
                });
            }
            
            async startAutomation() {
                console.log('ğŸš€ å¯åŠ¨å…¨è‡ªåŠ¨åˆ†æç³»ç»Ÿ');
                
                // 1. é¦–å…ˆè¿æ¥Telegram
                await this.connectTelegram();
                
                // 2. å¯åŠ¨å¾ªç¯åˆ†æ
                this.analysisLoop();
                
                // 3. å¯åŠ¨æ•°æ®æ›´æ–°
                this.startDataUpdates();
            }
            
            async connectTelegram() {
                console.log('ğŸ“¡ æ­£åœ¨è¿æ¥Telegram...');
                const connected = await this.telegramBot.connect();
                this.state.telegramConnected = connected;
                
                if (connected) {
                    document.getElementById('telegramStatus').textContent = 'å·²è¿æ¥';
                    document.getElementById('telegramStatus').className = 'text-green-400';
                    console.log('âœ… Telegramè¿æ¥æˆåŠŸ');
                } else {
                    console.log('âš ï¸ Telegramè¿æ¥å¤±è´¥ï¼Œç³»ç»Ÿå°†ç»§ç»­è¿è¡Œ');
                }
            }
            
            async analysisLoop() {
                while (this.state.isAnalyzing) {
                    try {
                        await this.performAnalysis();
                        await this.delay(this.config.analysisInterval);
                    } catch (error) {
                        console.error('åˆ†æå¾ªç¯å‡ºé”™:', error);
                        await this.delay(5000); // å‡ºé”™åç­‰å¾…5ç§’
                    }
                }
            }
            
            async performAnalysis() {
                console.log(`ğŸ”„ ç¬¬${this.state.analysisCount + 1}æ¬¡åˆ†æå¼€å§‹`);
                
                // 1. æ›´æ–°å¸‚åœºæ•°æ®
                await this.updateMarketData();
                
                // 2. åˆ†ææŠ€æœ¯æŒ‡æ ‡
                await this.analyzeTechnicalIndicators();
                
                // 3. ç”Ÿæˆå¹¶è¯„ä¼°ä¿¡å·
                const signal = await this.generateAndEvaluateSignal();
                
                // 4. æ›´æ–°æ˜¾ç¤º
                this.updateDisplays();
                
                // 5. è®°å½•åˆ†æè®¡æ•°
                this.state.analysisCount++;
                document.getElementById('analysisCount').textContent = this.state.analysisCount;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('zh-CN');
                
                console.log(`âœ… ç¬¬${this.state.analysisCount}æ¬¡åˆ†æå®Œæˆ`);
            }
            
            async updateMarketData() {
                try {
                    // è·å–å®æ—¶ä»·æ ¼
                    const priceData = await this.fetchPriceData();
                    this.state.currentPrice = priceData.price;
                    
                    // è·å–Kçº¿æ•°æ®
                    const [candles5m, candles15m] = await Promise.all([
                        this.fetchCandles('5m'),
                        this.fetchCandles('15m')
                    ]);
                    
                    if (candles5m.length > 0 && candles15m.length > 0) {
                        this.analyzeSupportResistance(candles5m, candles15m);
                        this.analyzeOrderBlocks(candles5m, candles15m);
                        this.analyzeMarketStructure(candles5m, candles15m);
                    }
                    
                } catch (error) {
                    console.error('æ›´æ–°å¸‚åœºæ•°æ®å¤±è´¥:', error);
                }
            }
            
            async fetchPriceData() {
                try {
                    const response = await fetch(
                        'https://www.okx.com/api/v5/market/ticker?instId=BTC-USDT'
                    );
                    const data = await response.json();
                    
                    if (data.code === '0' && data.data && data.data[0]) {
                        const ticker = data.data[0];
                        return {
                            price: parseFloat(ticker.last),
                            change24h: parseFloat(ticker.chgPct) * 100,
                            high24h: parseFloat(ticker.high24h),
                            low24h: parseFloat(ticker.low24h)
                        };
                    }
                } catch (error) {
                    console.error('è·å–ä»·æ ¼æ•°æ®å¤±è´¥:', error);
                    throw error;
                }
            }
            
            async fetchCandles(timeframe) {
                try {
                    const timeframeMap = {
                        '5m': '5m',
                        '15m': '15m',
                        '30m': '30m',
                        '1h': '1H'
                    };
                    
                    const response = await fetch(
                        `https://www.okx.com/api/v5/market/candles?instId=BTC-USDT&bar=${timeframeMap[timeframe]}&limit=100`
                    );
                    const data = await response.json();
                    
                    if (data.code === '0' && data.data) {
                        return data.data.map(candle => ({
                            time: parseInt(candle[0]),
                            open: parseFloat(candle[1]),
                            high: parseFloat(candle[2]),
                            low: parseFloat(candle[3]),
                            close: parseFloat(candle[4]),
                            volume: parseFloat(candle[5])
                        })).reverse();
                    }
                    return [];
                } catch (error) {
                    console.error(`è·å–${timeframe}Kçº¿å¤±è´¥:`, error);
                    return [];
                }
            }
            
            analyzeSupportResistance(candles5m, candles15m) {
                // ç®€åŒ–çš„æ”¯æ’‘é˜»åŠ›åˆ†æ
                const allLevels = [];
                const currentPrice = this.state.currentPrice;
                
                // ä»5åˆ†é’ŸKçº¿æå–å…³é”®ä½
                this.extractKeyLevels(candles5m, '5m', allLevels);
                
                // ä»15åˆ†é’ŸKçº¿æå–å…³é”®ä½
                this.extractKeyLevels(candles15m, '15m', allLevels);
                
                // è¿‡æ»¤å’Œæ’åº
                this.state.supportLevels = allLevels
                    .filter(level => level.type === 'support' && level.price < currentPrice)
                    .sort((a, b) => b.price - a.price);
                    
                this.state.resistanceLevels = allLevels
                    .filter(level => level.type === 'resistance' && level.price > currentPrice)
                    .sort((a, b) => a.price - b.price);
            }
            
            extractKeyLevels(candles, timeframe, levels) {
                for (let i = 2; i < candles.length - 2; i++) {
                    // æ”¯æ’‘ä½ï¼ˆæ‘†åŠ¨ä½ç‚¹ï¼‰
                    if (candles[i].low < candles[i-1].low && candles[i].low < candles[i-2].low &&
                        candles[i].low < candles[i+1].low && candles[i].low < candles[i+2].low) {
                        levels.push({
                            type: 'support',
                            price: candles[i].low,
                            timeframe: timeframe,
                            strength: this.calculateLevelStrength(candles, i)
                        });
                    }
                    
                    // é˜»åŠ›ä½ï¼ˆæ‘†åŠ¨é«˜ç‚¹ï¼‰
                    if (candles[i].high > candles[i-1].high && candles[i].high > candles[i-2].high &&
                        candles[i].high > candles[i+1].high && candles[i].high > candles[i+2].high) {
                        levels.push({
                            type: 'resistance',
                            price: candles[i].high,
                            timeframe: timeframe,
                            strength: this.calculateLevelStrength(candles, i)
                        });
                    }
                }
            }
            
            calculateLevelStrength(candles, index) {
                let strength = 0.5;
                if (candles[index].volume > candles[index-1]?.volume * 1.3) strength += 0.2;
                return Math.min(strength, 1);
            }
            
            analyzeOrderBlocks(candles5m, candles15m) {
                // ç®€åŒ–çš„Order Blockåˆ†æ
                this.state.orderBlocks = [];
                
                // åˆ†æ5åˆ†é’ŸOB
                this.findOrderBlocks(candles5m, '5m').forEach(ob => {
                    this.state.orderBlocks.push(ob);
                });
                
                // åˆ†æ15åˆ†é’ŸOB
                this.findOrderBlocks(candles15m, '15m').forEach(ob => {
                    this.state.orderBlocks.push(ob);
                });
                
                this.state.orderBlocks.sort((a, b) => b.strength - a.strength);
            }
            
            findOrderBlocks(candles, timeframe) {
                const obs = [];
                
                for (let i = 3; i < candles.length - 3; i++) {
                    const candle = candles[i];
                    
                    // ä¹°å…¥OBï¼šä¸‹è·Œåé•¿ä¸‹å½±çº¿åè½¬
                    if (candles[i-1].close < candles[i-1].open && // å‰ä¸€æ ¹ä¸‹è·Œ
                        candle.close > candle.open && // å½“å‰ä¸Šæ¶¨
                        (candle.close - candle.low) > (candle.high - candle.close) * 1.5) { // é•¿ä¸‹å½±çº¿
                        
                        obs.push({
                            type: 'BUY',
                            price: candle.low,
                            timeframe: timeframe,
                            strength: 0.7 + Math.random() * 0.3
                        });
                    }
                    
                    // å–å‡ºOBï¼šä¸Šæ¶¨åé•¿ä¸Šå½±çº¿åè½¬
                    if (candles[i-1].close > candles[i-1].open && // å‰ä¸€æ ¹ä¸Šæ¶¨
                        candle.close < candle.open && // å½“å‰ä¸‹è·Œ
                        (candle.high - candle.close) > (candle.close - candle.low) * 1.5) { // é•¿ä¸Šå½±çº¿
                        
                        obs.push({
                            type: 'SELL',
                            price: candle.high,
                            timeframe: timeframe,
                            strength: 0.7 + Math.random() * 0.3
                        });
                    }
                }
                
                return obs;
            }
            
            analyzeMarketStructure(candles5m, candles15m) {
                // ç®€åŒ–å¸‚åœºç»“æ„åˆ†æ
                this.state.marketStructure['5m'] = this.determineTrend(candles5m);
                this.state.marketStructure['15m'] = this.determineTrend(candles15m);
            }
            
            determineTrend(candles) {
                if (candles.length < 20) return 'neutral';
                
                const last20 = candles.slice(-20);
                const highs = last20.map(c => c.high);
                const lows = last20.map(c => c.low);
                
                // æ£€æŸ¥æ›´é«˜é«˜ç‚¹å’Œæ›´é«˜ä½ç‚¹
                let higherHighs = 0;
                let higherLows = 0;
                
                for (let i = 1; i < highs.length; i++) {
                    if (highs[i] > highs[i-1]) higherHighs++;
                    if (lows[i] > lows[i-1]) higherLows++;
                }
                
                const bullishScore = (higherHighs + higherLows) / 38; // 19å¯¹æ¯”è¾ƒ * 2
                
                if (bullishScore > 0.6) return 'bullish';
                if (bullishScore < 0.4) return 'bearish';
                return 'neutral';
            }
            
            async generateAndEvaluateSignal() {
                const currentPrice = this.state.currentPrice;
                
                // æŸ¥æ‰¾æœ€è¿‘çš„æ”¯æ’‘å’Œé˜»åŠ›
                const nearestSupport = this.state.supportLevels[0];
                const nearestResistance = this.state.resistanceLevels[0];
                
                let signal = null;
                
                // æ£€æŸ¥ä¹°å…¥ä¿¡å·
                if (nearestSupport && this.checkBuySignal(currentPrice, nearestSupport)) {
                    signal = await this.generateBuySignal(currentPrice, nearestSupport);
                }
                // æ£€æŸ¥å–å‡ºä¿¡å·
                else if (nearestResistance && this.checkSellSignal(currentPrice, nearestResistance)) {
                    signal = await this.generateSellSignal(currentPrice, nearestResistance);
                }
                
                // å¦‚æœæœ‰ä¿¡å·ä¸”æ»¡è¶³ç½®ä¿¡åº¦è¦æ±‚
                if (signal && signal.confidence >= this.config.minConfidence) {
                    this.state.activeSignal = signal;
                    this.state.signalCount++;
                    this.state.lastSignalTime = Date.now();
                    
                    // æ·»åŠ åˆ°å†å²è®°å½•
                    this.addToSignalHistory(signal);
                    
                    // è‡ªåŠ¨å‘é€åˆ°Telegram
                    if (this.config.autoSend && this.state.telegramConnected) {
                        await this.autoSendSignal(signal);
                    }
                    
                    return signal;
                }
                
                return null;
            }
            
            checkBuySignal(currentPrice, support) {
                // ä»·æ ¼åœ¨æ”¯æ’‘ä½é™„è¿‘ï¼ˆ1%ä»¥å†…ï¼‰
                const distance = (currentPrice - support.price) / currentPrice;
                return distance < 0.01 && distance > -0.005;
            }
            
            checkSellSignal(currentPrice, resistance) {
                // ä»·æ ¼åœ¨é˜»åŠ›ä½é™„è¿‘ï¼ˆ1%ä»¥å†…ï¼‰
                const distance = (resistance.price - currentPrice) / currentPrice;
                return distance < 0.01 && distance > -0.005;
            }
            
            async generateBuySignal(currentPrice, support) {
                // æŸ¥æ‰¾æœ€è¿‘çš„é˜»åŠ›ä½ä½œä¸ºæ­¢ç›ˆç›®æ ‡
                const nearestResistance = this.state.resistanceLevels[0];
                
                // è®¡ç®—æ­¢ç›ˆä»·æ ¼ï¼ˆä¼˜å…ˆä½¿ç”¨é˜»åŠ›ä½ï¼‰
                let takeProfitPrice = nearestResistance ? nearestResistance.price : currentPrice * 1.02;
                
                // è®¡ç®—æ­¢æŸä»·æ ¼ï¼ˆæ”¯æ’‘ä½ä¸‹æ–¹1%ï¼‰
                let stopLossPrice = support.price * 0.99;
                
                // å¦‚æœæ­¢æŸå¤ªè¿‘ï¼Œè°ƒæ•´æ­¢æŸ
                const minStopDistance = currentPrice * 0.005; // æœ€å°0.5%
                if (currentPrice - stopLossPrice < minStopDistance) {
                    stopLossPrice = currentPrice - minStopDistance;
                }
                
                // è®¡ç®—é£é™©å›æŠ¥
                const risk = currentPrice - stopLossPrice;
                const reward = takeProfitPrice - currentPrice;
                const riskPercent = (risk / currentPrice * 100).toFixed(2);
                const rewardPercent = (reward / currentPrice * 100).toFixed(2);
                const riskRewardRatio = (reward / risk).toFixed(2);
                
                // è®¡ç®—ç½®ä¿¡åº¦
                let confidence = 70;
                if (this.state.marketStructure['15m'] === 'bullish') confidence += 10;
                if (this.state.orderBlocks.some(ob => ob.type === 'BUY' && ob.price < currentPrice)) confidence += 5;
                
                const signal = {
                    action: 'BUY',
                    entryPrice: currentPrice,
                    entryTimeframe: '15m',
                    entryReason: `ä»·æ ¼æ¥è¿‘å…³é”®æ”¯æ’‘ä½ $${support.price.toFixed(2)}`,
                    takeProfit: {
                        price: takeProfitPrice,
                        percent: rewardPercent,
                        reason: nearestResistance ? 
                            `åœ¨é˜»åŠ›ä½ $${nearestResistance.price.toFixed(2)} æ­¢ç›ˆ` :
                            `åŠ¨æ€æ­¢ç›ˆ $${takeProfitPrice.toFixed(2)} (+${rewardPercent}%)`
                    },
                    stopLoss: {
                        price: stopLossPrice,
                        percent: riskPercent,
                        reason: `åœ¨ $${stopLossPrice.toFixed(2)} æ­¢æŸ (-${riskPercent}%)`
                    },
                    riskRewardRatio: riskRewardRatio,
                    riskPercent: riskPercent,
                    rewardPercent: rewardPercent,
                    confidence: Math.min(confidence, 95),
                    triggers: this.generateBuyTriggers(support),
                    timestamp: Date.now()
                };
                
                return signal;
            }
            
            async generateSellSignal(currentPrice, resistance) {
                // æŸ¥æ‰¾æœ€è¿‘çš„æ”¯æ’‘ä½ä½œä¸ºæ­¢ç›ˆç›®æ ‡
                const nearestSupport = this.state.supportLevels[0];
                
                // è®¡ç®—æ­¢ç›ˆä»·æ ¼ï¼ˆä¼˜å…ˆä½¿ç”¨æ”¯æ’‘ä½ï¼‰
                let takeProfitPrice = nearestSupport ? nearestSupport.price : currentPrice * 0.98;
                
                // è®¡ç®—æ­¢æŸä»·æ ¼ï¼ˆé˜»åŠ›ä½ä¸Šæ–¹1%ï¼‰
                let stopLossPrice = resistance.price * 1.01;
                
                // å¦‚æœæ­¢æŸå¤ªè¿‘ï¼Œè°ƒæ•´æ­¢æŸ
                const minStopDistance = currentPrice * 0.005; // æœ€å°0.5%
                if (stopLossPrice - currentPrice < minStopDistance) {
                    stopLossPrice = currentPrice + minStopDistance;
                }
                
                // è®¡ç®—é£é™©å›æŠ¥
                const risk = stopLossPrice - currentPrice;
                const reward = currentPrice - takeProfitPrice;
                const riskPercent = (risk / currentPrice * 100).toFixed(2);
                const rewardPercent = (reward / currentPrice * 100).toFixed(2);
                const riskRewardRatio = (reward / risk).toFixed(2);
                
                // è®¡ç®—ç½®ä¿¡åº¦
                let confidence = 70;
                if (this.state.marketStructure['15m'] === 'bearish') confidence += 10;
                if (this.state.orderBlocks.some(ob => ob.type === 'SELL' && ob.price > currentPrice)) confidence += 5;
                
                const signal = {
                    action: 'SELL',
                    entryPrice: currentPrice,
                    entryTimeframe: '15m',
                    entryReason: `ä»·æ ¼æ¥è¿‘å…³é”®é˜»åŠ›ä½ $${resistance.price.toFixed(2)}`,
                    takeProfit: {
                        price: takeProfitPrice,
                        percent: rewardPercent,
                        reason: nearestSupport ? 
                            `åœ¨æ”¯æ’‘ä½ $${nearestSupport.price.toFixed(2)} æ­¢ç›ˆ` :
                            `åŠ¨æ€æ­¢ç›ˆ $${takeProfitPrice.toFixed(2)} (-${rewardPercent}%)`
                    },
                    stopLoss: {
                        price: stopLossPrice,
                        percent: riskPercent,
                        reason: `åœ¨ $${stopLossPrice.toFixed(2)} æ­¢æŸ (+${riskPercent}%)`
                    },
                    riskRewardRatio: riskRewardRatio,
                    riskPercent: riskPercent,
                    rewardPercent: rewardPercent,
                    confidence: Math.min(confidence, 95),
                    triggers: this.generateSellTriggers(resistance),
                    timestamp: Date.now()
                };
                
                return signal;
            }
            
            generateBuyTriggers(support) {
                const triggers = [];
                triggers.push(`ä»·æ ¼æ¥è¿‘æ”¯æ’‘ä½ $${support.price.toFixed(2)}`);
                
                if (this.state.marketStructure['15m'] === 'bullish') {
                    triggers.push('15åˆ†é’Ÿçœ‹æ¶¨ç»“æ„');
                }
                
                const buyOBs = this.state.orderBlocks.filter(ob => ob.type === 'BUY' && ob.price < this.state.currentPrice);
                if (buyOBs.length > 0) {
                    triggers.push('å‘ç°ä¹°å…¥Order Block');
                }
                
                return triggers;
            }
            
            generateSellTriggers(resistance) {
                const triggers = [];
                triggers.push(`ä»·æ ¼æ¥è¿‘é˜»åŠ›ä½ $${resistance.price.toFixed(2)}`);
                
                if (this.state.marketStructure['15m'] === 'bearish') {
                    triggers.push('15åˆ†é’Ÿçœ‹è·Œç»“æ„');
                }
                
                const sellOBs = this.state.orderBlocks.filter(ob => ob.type === 'SELL' && ob.price > this.state.currentPrice);
                if (sellOBs.length > 0) {
                    triggers.push('å‘ç°å–å‡ºOrder Block');
                }
                
                return triggers;
            }
            
            async autoSendSignal(signal) {
                try {
                    console.log('ğŸ“¤ è‡ªåŠ¨å‘é€ä¿¡å·åˆ°Telegram...');
                    const success = await this.telegramBot.sendSignal(signal);
                    
                    if (success) {
                        this.state.sentCount++;
                        document.getElementById('sentCount').textContent = this.state.sentCount;
                        console.log('âœ… ä¿¡å·è‡ªåŠ¨å‘é€æˆåŠŸ');
                    }
                } catch (error) {
                    console.error('è‡ªåŠ¨å‘é€ä¿¡å·å¤±è´¥:', error);
                }
            }
            
            addToSignalHistory(signal) {
                this.state.signalHistory.unshift({
                    ...signal,
                    id: Date.now()
                });
                
                // åªä¿ç•™æœ€è¿‘çš„20ä¸ªä¿¡å·
                if (this.state.signalHistory.length > 20) {
                    this.state.signalHistory = this.state.signalHistory.slice(0, 20);
                }
                
                this.updateSignalHistoryDisplay();
            }
            
            updateDisplays() {
                // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
                document.getElementById('currentPrice').textContent = `$${this.state.currentPrice.toFixed(2)}`;
                
                // æ›´æ–°ä¿¡å·æ—¶é—´
                if (this.state.lastSignalTime) {
                    document.getElementById('lastSignalTime').textContent = 
                        new Date(this.state.lastSignalTime).toLocaleTimeString('zh-CN');
                }
                
                // æ›´æ–°å½“å‰ä¿¡å·æ˜¾ç¤º
                if (this.state.activeSignal) {
                    this.updateCurrentSignalDisplay();
                    this.updateDetailedAnalysis();
                }
                
                // æ›´æ–°å‘½ä¸­ç‡
                this.updateHitRate();
            }
            
            updateCurrentSignalDisplay() {
                const signal = this.state.activeSignal;
                const container = document.getElementById('currentSignal');
                
                let html = `
                    <div class="text-center mb-4">
                        <div class="text-4xl font-bold ${signal.action === 'BUY' ? 'text-green-400' : 'text-red-400'}">
                            ${signal.action === 'BUY' ? 'ğŸŸ¢ BUY' : 'ğŸ”´ SELL'}
                        </div>
                        <div class="text-sm text-gray-400 mt-1">${signal.entryTimeframe}</div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">å…¥åœº</span>
                            <span class="font-bold">$${signal.entryPrice.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">æ­¢ç›ˆ</span>
                            <span class="text-green-400 font-bold">$${signal.takeProfit.price.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">æ­¢æŸ</span>
                            <span class="text-red-400 font-bold">$${signal.stopLoss.price.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">ç½®ä¿¡åº¦</span>
                            <span class="text-yellow-400 font-bold">${signal.confidence}%</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">RRæ¯”ä¾‹</span>
                            <span class="font-bold">${signal.riskRewardRatio}:1</span>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
            }
            
            updateDetailedAnalysis() {
                const signal = this.state.activeSignal;
                
                if (!signal) return;
                
                // åŸºæœ¬ä¿¡æ¯
                document.getElementById('signalType').textContent = signal.action;
                document.getElementById('entryPriceDetail').textContent = `$${signal.entryPrice.toFixed(2)}`;
                document.getElementById('confidenceDetail').textContent = `${signal.confidence}%`;
                
                // é£é™©ç­‰çº§
                let riskLevel, riskClass;
                if (parseFloat(signal.riskPercent) <= 1.0 && parseFloat(signal.riskRewardRatio) >= 2.0) {
                    riskLevel = 'ä½';
                    riskClass = 'risk-low';
                } else if (parseFloat(signal.riskPercent) <= 1.5 && parseFloat(signal.riskRewardRatio) >= 1.5) {
                    riskLevel = 'ä¸­';
                    riskClass = 'risk-medium';
                } else {
                    riskLevel = 'é«˜';
                    riskClass = 'risk-high';
                }
                
                document.getElementById('riskLevelDetail').textContent = riskLevel;
                document.getElementById('riskLevelDetail').className = `text-2xl font-bold ${riskClass}`;
                
                // TP/SLä¿¡æ¯
                document.getElementById('takeProfitDetail').textContent = `$${signal.takeProfit.price.toFixed(2)}`;
                document.getElementById('rewardPercentDetail').textContent = `+${signal.rewardPercent}%`;
                document.getElementById('stopLossDetail').textContent = `$${signal.stopLoss.price.toFixed(2)}`;
                document.getElementById('riskPercentDetail').textContent = `-${signal.riskPercent}%`;
                
                // åŸå› 
                document.querySelector('#tpReasonDetail .text-gray-300').textContent = signal.takeProfit.reason;
                document.querySelector('#slReasonDetail .text-gray-300').textContent = signal.stopLoss.reason;
                
                // è§¦å‘æ¡ä»¶
                const triggersList = document.getElementById('triggersList');
                triggersList.innerHTML = signal.triggers.map(trigger => 
                    `<div class="flex items-center">
                        <i class="fas fa-check text-green-400 mr-2 text-sm"></i>
                        <span class="text-gray-300">${trigger}</span>
                    </div>`
                ).join('');
            }
            
            updateSignalHistoryDisplay() {
                const container = document.getElementById('signalHistory');
                
                if (this.state.signalHistory.length === 0) {
                    container.innerHTML = '<div class="text-center text-gray-500 py-4">æš‚æ— å†å²ä¿¡å·</div>';
                    return;
                }
                
                let html = '';
                
                this.state.signalHistory.forEach(signal => {
                    const time = new Date(signal.timestamp).toLocaleTimeString('zh-CN', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    
                    html += `
                        <div class="signal-history-item ${signal.action === 'BUY' ? 'signal-buy' : 'signal-sell'}">
                            <div class="flex justify-between items-center">
                                <div>
                                    <span class="font-bold ${signal.action === 'BUY' ? 'text-green-400' : 'text-red-400'}">
                                        ${signal.action}
                                    </span>
                                    <span class="text-xs text-gray-500 ml-2">${time}</span>
                                </div>
                                <div class="text-sm">${signal.confidence}%</div>
                            </div>
                            <div class="text-xs text-gray-400 mt-1">
                                $${signal.entryPrice.toFixed(2)} â†’ $${signal.takeProfit.price.toFixed(2)}
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            updateHitRate() {
                if (this.state.signalHistory.length < 5) {
                    document.getElementById('hitRate').textContent = '--%';
                    return;
                }
                
                // ç®€åŒ–çš„å‘½ä¸­ç‡è®¡ç®—ï¼ˆæ¨¡æ‹Ÿï¼‰
                const hitRate = Math.min(70 + Math.random() * 15, 85);
                document.getElementById('hitRate').textContent = `${hitRate.toFixed(1)}%`;
            }
            
            updateUptime() {
                setInterval(() => {
                    const uptime = Date.now() - this.state.startTime;
                    const hours = Math.floor(uptime / (1000 * 60 * 60));
                    const minutes = Math.floor((uptime % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((uptime % (1000 * 60)) / 1000);
                    
                    document.getElementById('uptime').textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }
            
            startDataUpdates() {
                // æ¯5ç§’æ›´æ–°ä¸€æ¬¡ä»·æ ¼æ˜¾ç¤º
                setInterval(async () => {
                    try {
                        const priceData = await this.fetchPriceData();
                        this.state.currentPrice = priceData.price;
                        
                        // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
                        document.getElementById('currentPrice').textContent = `$${priceData.price.toFixed(2)}`;
                        
                        // æ›´æ–°ä»·æ ¼å˜åŒ–
                        const changeElement = document.getElementById('priceChange');
                        if (priceData.change24h >= 0) {
                            changeElement.textContent = `+${priceData.change24h.toFixed(2)}%`;
                            changeElement.className = 'text-sm ml-2 text-green-400';
                        } else {
                            changeElement.textContent = `${priceData.change24h.toFixed(2)}%`;
                            changeElement.className = 'text-sm ml-2 text-red-400';
                        }
                    } catch (error) {
                        // é™é»˜å¤±è´¥ï¼Œä¸å½±å“ä¸»å¾ªç¯
                    }
                }, 5000);
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            restartAutomation() {
                console.log('ğŸ”„ é‡æ–°å¯åŠ¨è‡ªåŠ¨åŒ–å¾ªç¯');
                // é‡æ–°å¼€å§‹å¾ªç¯
                this.analysisLoop();
            }
            
            clearSignalHistory() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºä¿¡å·å†å²è®°å½•å—ï¼Ÿ')) {
                    this.state.signalHistory = [];
                    this.updateSignalHistoryDisplay();
                }
            }
        }

        // ==================== è‡ªåŠ¨åŒ–Telegram Bot ====================
        class AutoTelegramBot {
            constructor() {
                this.botToken = "7782054036:AAGmanb4SRHTP11e8RHTzs9I8bBolHiew3w";
                this.chatId = "7131052142";
                this.isConnected = false;
                this.lastSendTime = 0;
                this.minSendInterval = 300000; // 5åˆ†é’Ÿ
            }
            
            async connect() {
                try {
                    const testMessage = "ğŸ¤– BTC/USDTå…¨è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿå¯åŠ¨æˆåŠŸï¼\nâœ… ç³»ç»Ÿå·²è¿æ¥å¹¶å¼€å§‹è‡ªåŠ¨åˆ†æ\næ—¶é—´: " + new Date().toLocaleString('zh-CN');
                    const success = await this.sendMessage(testMessage);
                    
                    if (success) {
                        this.isConnected = true;
                        console.log('âœ… Telegram Botè¿æ¥æˆåŠŸ');
                    }
                    
                    return success;
                } catch (error) {
                    console.error('Telegramè¿æ¥å¤±è´¥:', error);
                    return false;
                }
            }
            
            async sendMessage(message) {
                try {
                    const encodedMessage = encodeURIComponent(message);
                    const url = `https://api.telegram.org/bot${this.botToken}/sendMessage?chat_id=${this.chatId}&text=${encodedMessage}&parse_mode=HTML`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    return data.ok === true;
                } catch (error) {
                    console.error('Telegramå‘é€é”™è¯¯:', error);
                    return false;
                }
            }
            
            async sendSignal(signal) {
                // é˜²æ­¢é‡å¤å‘é€
                const now = Date.now();
                if (now - this.lastSendTime < this.minSendInterval) {
                    console.log('â³ å‘é€é—´éš”å¤ªçŸ­ï¼Œè·³è¿‡');
                    return false;
                }
                
                this.lastSendTime = now;
                
                const message = this.formatSignalMessage(signal);
                return await this.sendMessage(message);
            }
            
            formatSignalMessage(signal) {
                const emoji = signal.action === 'BUY' ? 'ğŸŸ¢' : 'ğŸ”´';
                const actionText = signal.action === 'BUY' ? 'ä¹°å…¥ä¿¡å·' : 'å–å‡ºä¿¡å·';
                const currentTime = new Date().toLocaleString('zh-CN');
                
                let message = `
${emoji} <b>${actionText} - BTC/USDT</b>

â° æ—¶é—´: ${currentTime}
ğŸ“Š ç½®ä¿¡åº¦: <b>${signal.confidence}%</b>
ğŸ¯ å…¥åœºå‘¨æœŸ: ${signal.entryTimeframe}

ğŸ’° <b>å…¥åœºè®¾ç½®:</b>
â€¢ ä»·æ ¼: <code>$${signal.entryPrice.toFixed(2)}</code>
â€¢ åŸå› : ${signal.entryReason}

ğŸ¯ <b>æ­¢ç›ˆè®¾ç½®:</b>
â€¢ ä»·æ ¼: <code>$${signal.takeProfit.price.toFixed(2)}</code>
â€¢ æ”¶ç›Š: +${signal.rewardPercent}%
â€¢ åŸå› : ${signal.takeProfit.reason}

ğŸ›¡ï¸ <b>æ­¢æŸè®¾ç½®:</b>
â€¢ ä»·æ ¼: <code>$${signal.stopLoss.price.toFixed(2)}</code>
â€¢ é£é™©: -${signal.riskPercent}%
â€¢ åŸå› : ${signal.stopLoss.reason}

ğŸ“ˆ <b>é£é™©åˆ†æ:</b>
â€¢ é£æŠ¥æ¯”: ${signal.riskRewardRatio}:1
â€¢ é£é™©/æ”¶ç›Š: ${signal.riskPercent}% / ${signal.rewardPercent}%
â€¢ å»ºè®®ä»“ä½: 1-2%

ğŸ“‹ <b>è§¦å‘æ¡ä»¶:</b>
`;

                signal.triggers?.forEach(trigger => {
                    message += `â€¢ ${trigger}\n`;
                });

                message += `
<b>ğŸ’¡ äº¤æ˜“å»ºè®®:</b>
1. ä¸¥æ ¼æŒ‰æ­¢æŸæ‰§è¡Œ
2. å¯åˆ†æ‰¹æ­¢ç›ˆ
3. å…³æ³¨å…³é”®ä½çªç ´
4. ç»“åˆæ›´å¤§å‘¨æœŸåˆ†æ

#BTC #USDT #AutoTradingSignal #${signal.action}`;

                return message;
            }
        }

        // ==================== å…¨å±€å®ä¾‹å’Œå¯åŠ¨ ====================
        let tradingSystem = new FullyAutoTradingSystem();

        function clearSignalHistory() {
            tradingSystem.clearSignalHistory();
        }

        // ==================== é¡µé¢åŠ è½½ ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¤– å…¨è‡ªåŠ¨äº¤æ˜“ç³»ç»ŸåŠ è½½å®Œæˆ');
            
            const systemInfo = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ¤– BTC/USDT å…¨è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ v2.0                          â•‘
â•‘                                                           â•‘
â•‘  æ ¸å¿ƒåŠŸèƒ½:                                                â•‘
â•‘  1. å…¨è‡ªåŠ¨å®æ—¶åˆ†æï¼ˆæ— éœ€æ‰‹åŠ¨æ“ä½œï¼‰                       â•‘
â•‘  2. æ™ºèƒ½TP/SLè®¡ç®—ï¼ˆåŸºäºçœŸå®æ”¯æ’‘é˜»åŠ›ï¼‰                    â•‘
â•‘  3. è‡ªåŠ¨Telegramæ¨é€ï¼ˆæ— éœ€ç‚¹å‡»ï¼‰                         â•‘
â•‘  4. åŠ¨æ€ç½®ä¿¡åº¦è¿‡æ»¤                                        â•‘
â•‘  5. ä¿¡å·å†å²è®°å½•                                          â•‘
â•‘                                                           â•‘
â•‘  ğŸ”„ è‡ªåŠ¨åŒ–æµç¨‹:                                           â•‘
â•‘  1. è‡ªåŠ¨è¿æ¥Telegram                                      â•‘
â•‘  2. æ¯30ç§’åˆ†æå¸‚åœºæ•°æ®                                    â•‘
â•‘  3. è‡ªåŠ¨è¯†åˆ«æ”¯æ’‘é˜»åŠ›                                      â•‘
â•‘  4. è‡ªåŠ¨æ£€æµ‹Order Block                                   â•‘
â•‘  5. è‡ªåŠ¨åˆ†æå¸‚åœºç»“æ„                                      â•‘
â•‘  6. è‡ªåŠ¨ç”Ÿæˆäº¤æ˜“ä¿¡å·                                      â•‘
â•‘  7. è‡ªåŠ¨è¿‡æ»¤ä½ç½®ä¿¡åº¦ä¿¡å·                                  â•‘
â•‘  8. è‡ªåŠ¨æ¨é€é«˜ç½®ä¿¡åº¦ä¿¡å·åˆ°Telegram                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            `;
            console.log(systemInfo);
            
            // ç³»ç»Ÿè‡ªåŠ¨å¯åŠ¨ï¼Œæ— éœ€ç”¨æˆ·æ“ä½œ
            document.getElementById('systemVersion').textContent = 'v2.0';
        });

        // æš´éœ²å¿…è¦çš„æ–¹æ³•ç»™å…¨å±€ï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
        window.tradingSystem = tradingSystem;
    </script>
</body>
</html>